---
title: "Extracción de informacion"
author: "Sofía"
---



```{r}

library(sf)
library(tidyverse)
library(raster)
library(gtools)

sf_use_s2(FALSE)

chi <- st_read("~/Downloads/chiapas_usyv_geo/chiapas_usyv_geo.shp")%>%
                st_as_sf()


oax <- st_read("~/Downloads/oaxaca_usyv_geo/oaxaca_usyv_geo_Wtu2Z5w.shp") %>% st_as_sf()


coord <- read.csv("coordinates.csv")%>%
            st_as_sf(., coords = c("lon","lat"), crs = 4326, remove = F)

coord_info_ch <- st_intersection(chi, coord) %>% 
                 st_drop_geometry() %>% 
                 dplyr::select(CVE_VE, TIP_VEG, time, lat, lon, ele, name)

coord_info_oax <- st_intersection(oax, coord) %>% 
                  st_drop_geometry() %>% 
                  dplyr::select(CVE_VE, TIP_VEG, time, lat, lon, ele, name)



bind_rows(coord_info_ch,coord_info_oax) %>% st_drop_geometry() %>% dplyr::select(CVE_VE, TIP_VEG, time, lat, lon, ele, name) %>% write.csv("coord_info.csv", row.names = F)

library(googlesheets4)

metadata <- read_sheet("https://docs.google.com/spreadsheets/d/1MiuC_w-Mcv7JuXKkO0eS0xQE1YvSIRfuVz76mRzEkz0/edit?usp=sharing", col_types = "iiccccccccccidddcccDc")

coords <- read.csv("coordinates.csv")%>%
    dplyr::arrange(mixedsort(name))

coord_info <- read.csv("coord_info.csv")

left_join(metadata, coords, by = c("codigo_colecta"="name"))%>%
left_join(.,coord_info[,c("TIP_VEG","name")], by = c("codigo_colecta"= "name"))%>% write.csv("coord_info_veg.csv", row.names = F)



```
