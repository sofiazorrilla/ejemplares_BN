library(RMariaDB)
library(googlesheets4)
conn <- dbConnect(
drv = RMariaDB::MariaDB(),
username = "sofia",
password = "sofia",
host = "localhost",
port = 3306,
dbname = "ejemplares_BN"
)
sql_search <- "SELECT e.id_ejemplar,
e.id_individuo,
e.localizacion,
e.codigo_colecta,
i.id_individuo,
edo.estado,
i.fecha,
fe.id_foto
FROM ejemplares e
left join individuos i on e.id_individuo = i.id_individuo
left JOIN estados edo on i.id_estado = edo.id_estado
LEFT JOIN fotos_ejemplares fe on e.id_ejemplar = fe.id_ejemplar
WHERE e.localizacion REGEXP '^[0-9]+$' OR ISNULL(e.localizacion)
ORDER BY CAST(e.localizacion AS UNSIGNED);"
dbSendQuery(conn, sql_search) %>% dbFetch()
ejemplares <- dbSendQuery(conn, sql_search) %>% dbFetch()
library(tidyverse)
ejemplares %>% group_by(localizacion) %>%
group_split()
sql_search <- "SELECT e.id_ejemplar,
e.id_individuo,
e.localizacion,
e.codigo_colecta,
edo.estado,
i.fecha,
fe.id_foto
FROM ejemplares e
left join individuos i on e.id_individuo = i.id_individuo
left JOIN estados edo on i.id_estado = edo.id_estado
LEFT JOIN fotos_ejemplares fe on e.id_ejemplar = fe.id_ejemplar
WHERE e.localizacion REGEXP '^[0-9]+$' OR ISNULL(e.localizacion)
ORDER BY CAST(e.localizacion AS UNSIGNED);
"
ejemplares <- dbSendQuery(conn, sql_search) %>% dbFetch()
ejemplares %>% group_by(localizacion) %>%
group_split()
ejemplares %>% group_by(localizacion) %>%
group_split() %>%
mutate(revision = "")
ejemplares %>% group_by(localizacion) %>%
mutate(revision = "")%>%
group_split()
lista_ejemplares <- ejemplares %>% group_by(localizacion) %>%
mutate(revision = "")%>%
group_split()
lista_ejemplares
i = 1
unique(lista_ejemplares[[i]]$localizacion)
write_sheet(lista_ejemplares[[i]],ss = ss,sheet = paste0("caja_",unique(lista_ejemplares[[i]]$localizacion)))
ss <- "https://docs.google.com/spreadsheets/d/1y_48Pjkdxh7Omxs0nK0Fu-vEkkVi5KWDzA1h7ugzpzw/edit?usp=sharing"
write_sheet(lista_ejemplares[[i]],ss = ss,sheet = paste0("caja_",unique(lista_ejemplares[[i]]$localizacion)))
lista_ejemplares <- ejemplares %>% group_by(localizacion) %>%
mutate(revision = "")%>%
distinct() %>%
group_split()
write_sheet(lista_ejemplares[[i]],ss = ss,sheet = paste0("caja_",unique(lista_ejemplares[[i]]$localizacion)))
for(i in seq_along(lista_ejemplares)){
write_sheet(lista_ejemplares[[i]],ss = ss,sheet = paste0("caja_",unique(lista_ejemplares[[i]]$localizacion)))
}
library(gtools)
lista_ejemplares <- ejemplares %>% group_by(localizacion) %>%
mutate(revision = "")%>%
distinct() %>%
arrange(mixedsort(localizacion)) %>%
group_split()
lista_ejemplares
lista_ejemplares <- ejemplares %>% group_by(localizacion) %>%
mutate(revision = "")%>%
distinct() %>%
arrange(mixedsort(localizacion))
View(lista_ejemplares)
lista_ejemplares <- ejemplares %>% group_by(localizacion) %>%
mutate(revision = "", localizacion = as.numeric(localizacion))%>%
distinct() %>%
arrange(localizacion) %>%
group_split()
lista_ejemplares <- ejemplares %>% group_by(localizacion) %>%
mutate(revision = "", localizacion = as.numeric(localizacion))%>%
distinct() %>%
arrange(localizacion)
View(lista_ejemplares)
lista_ejemplares <- ejemplares %>% group_by(localizacion) %>%
mutate(revision = "", localizacion = as.numeric(localizacion))%>%
distinct() %>%
arrange(localizacion) %>%
group_split()
ss <- "https://docs.google.com/spreadsheets/d/1y_48Pjkdxh7Omxs0nK0Fu-vEkkVi5KWDzA1h7ugzpzw/edit?usp=sharing"
for(i in seq_along(lista_ejemplares)){
write_sheet(lista_ejemplares[[i]],ss = ss,sheet = paste0("caja_",unique(lista_ejemplares[[i]]$localizacion)))
}
for(i in seq_along(lista_ejemplares)){
write_sheet(lista_ejemplares[[i]],ss = ss,sheet = paste0("caja_",unique(lista_ejemplares[[i]]$localizacion)))
}
ss = "https://docs.google.com/spreadsheets/d/121j3-WTRLWDTDmYH-bZ9eTLDdUvtPrmcqY4eLixgz50/edit?usp=sharing"
individuos <- read_sheet(ss,sheet = 1)
ind_ej <- read_sheet(ss,sheet = 2)
ind_ej
individuos <- read_sheet(ss,sheet = 1) %>%
select(id_individuo, localizacion = caja, codigo_colecta, estado = Estado, fecha = Fecha_colecta )
ind_ej <- read_sheet(ss,sheet = 2) %>%
select(id_ejemplar, id_individuo, id_foto, Codigo_Foto_HAZ)
ind_ej <- read_sheet(ss,sheet = 2) %>%
select(id_ejemplar, id_individuo, id_foto =Codigo_Foto_HAZ)
ind_ej
ind_ej <- read_sheet(ss,sheet = 2) %>%
select(id_ejemplar, id_individuo, id_foto = Codigo_Foto_HAZ) %>%
mutate(id_foto = str_remove(id_foto, "_*$"))
ind_ej
ind_ej <- read_sheet(ss,sheet = 2) %>%
select(id_ejemplar, id_individuo, id_foto = Codigo_Foto_HAZ) %>%
mutate(id_foto = str_remove(id_foto, "_\\d"))
ind_ej
left_join(ind_ej, individuos, by = id_individuo)
left_join(ind_ej, individuos, by = "id_individuo")
individuos <- read_sheet(ss,sheet = 1) %>%
select(id_individuo, localizacion = caja, codigo_colecta, estado = Estado, fecha = Fecha_colecta ) %>%
mutate(fecha = as.Date(fecha))
ind_ej <- read_sheet(ss,sheet = 2) %>%
select(id_ejemplar, id_individuo, id_foto = Codigo_Foto_HAZ) %>%
mutate(id_foto = str_remove(id_foto, "_\\d"))
left_join(ind_ej, individuos, by = "id_individuo")
left_join(ind_ej, individuos, by = "id_individuo") %>% select(id_ejemplar,	id_individuo,	localizacion,	codigo_colecta,	estado,	fecha,	id_foto,	revision = "")
left_join(ind_ej, individuos, by = "id_individuo") %>% select(id_ejemplar,	id_individuo,	localizacion,	codigo_colecta,	estado,	fecha,	id_foto) %>% mutate(revision = "")
ss1 <- "https://docs.google.com/spreadsheets/d/1y_48Pjkdxh7Omxs0nK0Fu-vEkkVi5KWDzA1h7ugzpzw/edit?usp=sharing"
left_join(ind_ej, individuos, by = "id_individuo") %>% select(id_ejemplar,	id_individuo,	localizacion,	codigo_colecta,	estado,	fecha,	id_foto) %>% mutate(revision = "") %>% write_sheet(.,ss = ss1,sheet = paste0("caja_",unique(.$localizacion)))
ss = "https://docs.google.com/spreadsheets/d/1-d5ca4A9eL5cDq0Y2zFuN6OiYeAoe8m4LcQCQbpYV74/edit?usp=sharing"
individuos <- read_sheet(ss,sheet = 1) %>%
select(id_individuo, localizacion = caja, codigo_colecta, estado = Estado, fecha = Fecha_colecta ) %>%
mutate(fecha = as.Date(fecha))
individuos <- read_sheet(ss,sheet = 1) %>%
select(id_individuo, codigo_colecta, estado = Estado, fecha = Fecha_colecta ) %>%
mutate(fecha = as.Date(fecha), localizacion = "")
ind_ej <- read_sheet(ss,sheet = 2) %>%
select(id_ejemplar, id_individuo, id_foto = Codigo_Foto_HAZ) %>%
mutate(id_foto = str_remove(id_foto, "_\\d"))
ind_ej
left_join(ind_ej, individuos, by = "id_individuo") %>% select(id_ejemplar,	id_individuo,	localizacion,	codigo_colecta,	estado,	fecha,	id_foto) %>% mutate(revision = "") %>% write_sheet(.,ss = ss1,sheet = paste0("caja_",unique(.$localizacion)))
ss = "https://docs.google.com/spreadsheets/d/1dymbG-dIjeXGbZNJ_-4p44JDXZDvfKNcnfdRCtS4Tu0/edit?usp=sharing"
individuos <- read_sheet(ss,sheet = 1) %>%
select(id_individuo, codigo_colecta, estado = Estado, fecha = Fecha_colecta ) %>%
mutate(fecha = as.Date(fecha), localizacion = "")
individuos
ind_ej <- read_sheet(ss,sheet = 2) %>%
select(id_ejemplar, id_individuo) %>%
mutate(id_foto = "")
left_join(ind_ej, individuos, by = "id_individuo") %>% select(id_ejemplar,	id_individuo,	localizacion,	codigo_colecta,	estado,	fecha,	id_foto) %>% mutate(revision = "") %>% write_sheet(.,ss = ss1,sheet = paste0("caja_",unique(.$localizacion)))
