---
title: "Tutorial para generar etiquetas de ejemplares"
author: "Sofía Zorrilla Azcué"
format: pdf
geometry:
  - top=30mm
  - left=10mm
  - right=10mm
include-in-header: 
  text: |
    \usepackage{fvextra}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}

---



# Paso 1: Preparar tabla de datos

Rellenar una tabla con los metadatos de los ejemplares que contenga las siguientes columnas (recuerda nombrarlas sustituyendo los espacios en los encabezados por '_'):

```{r}
#| echo: false
#| message: false
#| warning: false

library(googlesheets4)
library(tidyverse)
library(kableExtra)

data = read_sheet("https://docs.google.com/spreadsheets/d/1F-Q5FqYZhQ2fKJRnADKZfV4_0yPdrYFa84vUdVzefwc/edit?usp=sharing", sheet = 1, col_types = 'dddcccccccddddcccDc') %>% select(-c(caja, Nombre_cientifico,Familia,TIP_VEG_INFyS)) %>% mutate(Altitud = round(Altitud, digits = 0), Colectores = "Hernando Rodríguez Correa, Sofía Zorrilla Azcué, Andrew Hipp")

colnames(data) <- str_replace(colnames(data), "_", " ")

kable(head(data), booktabs = T, align = "c", format = "latex") %>%
  kable_styling(latex_options = c("striped", "hold_position")) %>% 
  column_spec(c(4,12,13,15), width = "6em") %>%
  column_spec(c(1,2,3,8), width = "3em") %>% 
  kable_styling(latex_options="scale_down")
```

Especificaciones de columnas:

  - ejemplares: Número de réplicas que se colectaron por individuo
  - id_individuo: Revisar el último número en la base de datos y asignar los siguientes (uno por individuo)
  - latitud y longitud: coordenadas decimales
  
  
## Creación de etiquetas 

El script para crear etiquetas solo permite crear 200 etiquetas a la vez por lo que hay que correr el comando para cada grupo de 200. El script tiene cuatro parámetros:

Una de las funciones del script es extender la tabla de información para que haya una fila por ejemplar. Es decir si para el primer individuo se colectaron 3 réplicas, la fila que contiene la información del individuo se repite 3 veces (una por ejemplar).

- `min`: se refiere al número de fila en el que inicia la generación de etiquetas. El conteo no es el id del individuo, es el número de fila en la tabla de información. Este comando y el de `max` sirven para limitar el número de etiquetas. Hay que calcular cuantas filas se van a generar cuando la tabla se extienda para no sobrepasar el límite de 200.

- `max`: se refiere al número de fila en el que termina la generación de etiquetas.

- `min_id_ejemplar`: Automaticamente el script asigna el id de los ejemplares cuando extiende la tabla. En este parámetro hay que poner el número en el que tiene que iniciar (el consecutivo al último número en la base de datos).

- `path_to_coordinates`: El link de google drive para la hoja con las coordenadas. Nota: Hay que configurar el acceso a google drive utilizando el paquete [`googlesheets4`](https://googlesheets4.tidyverse.org/articles/googlesheets4.html). La primera vez que se utiliza el paquete va a pedir autorización en una ventana emergente del navegador.

- `col_types:` Código con los tipos de columna (d = número con decimales, D = fecha, c = caracter)

- `o` Nombre del archivo de etiquetas. 


```{r}
#| eval: false

quarto render labels.qmd \
-P min:1 \
-P max:100 \
-P min_id_ejemplar:1361 \
-P path_to_coordinates: "https://docs.google.com/spreadsheets/d/1F-Q5FqYZhQ2fKJRnADKZfV4_0yPdrYFa84vUdVzefwc/edit?usp=sharing" \
-o labels_1_100.html 
```

## Impresión de etiquetas

Se pueden imprimir seis etiquetas en una página cuando se asigna la escala a 70% en la impresión del navegador.
